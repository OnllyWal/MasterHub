<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Desktop Status</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/onoffstyle.css') }}">
</head>
<body>

    <!-- Grid com os Computadores-->
    <div class="grid-container1"></div>

    <!-- Aba  informacional-->
    <div class="side-panel">
        <button class="close-btn" onclick="closePanel()">Fechar</button>
        <div class="info-container">
        </div>
        <ul class="names-list"></ul>
    </div>    
    <script>
        const gridContainer = document.querySelector('.grid-container1');
        const states = JSON.parse('{{states | safe}}')
        const sidePanel = document.querySelector('.side-panel');
        const infocontainer = document.querySelector('.info-container');
        const namesList = document.querySelector('.names-list')
        const Data =  JSON.parse('{{data | safe}}')

        //GRID INTERACTIONS
        for (let i = 0; i < 20; i++) {

            // Cria o espaçamento no centro
            if (i%4 === 2){
                const spacement = document.createElement('div');
                spacement.className = 'spacement';
                spacement.innerHTML = `<div class="column_space"> </div>`
                gridContainer.appendChild(spacement);
            }

            // Cria um novo desktop-container
            const desktopContainer = document.createElement('div');
            desktopContainer.className = 'desktop_container';
            desktopContainer.onclick = function(){
                openPanel(i);
            };

            desktopContainer.innerHTML = `
                <div class="container_monitor">
                    <div class="tela"></div>
                    <div class="visor" id="visor-${i}"></div>
                    <div class="conector" id="conector"></div>
                    <div class="base" id="base"></div>
                    <div class="teclado" id="teclado"></div>
                    <div class="gabinete" id="gabinete"></div>
                    <div class="mesa" id="mesa"></div>
                    <div class="cadeira" id="cadeira-${i}"></div>
                    <div class="encosto" id="encosto"></div>
                    <div class="braco_1" id="braco_1"></div>
                    <div class="braco_2" id="braco_2"></div>
                </div>
            </div>
            `;

            // Insere no grid-container
            gridContainer.appendChild(desktopContainer);
        }

        // Adiciona a funcionalidade de ligar/desligar em todos os conjuntos
        const desktops = document.querySelectorAll('.desktop_container');

        desktops.forEach((desktop, index) => {
            const screen = desktop.querySelector(`#visor-${index}`);
            const chair = desktop.querySelector(`#cadeira-${index}`);
            const state = states[index];

            chair.classList.toggle('active', state)
            screen.classList.toggle('active', state); // Adicionar/Remover classe 'active'

        });

        // Função para abrir a aba lateral
        function openPanel(i) {
            sidePanel.classList.add('open');
            gridContainer.classList.add('grid-shift');

            //Exibe Informações sobre o computador

            infocontainer.innerHTML = `
                <p>IP: ${Data[i].ip}</p>
                <p>Memória Total: ${Data[i].total}</p>
                <p>Memória Disponível: ${Data[i].free}</p>

            `;

            // Aqui podemos também adicionar conteúdo personalizado na aba lateral, como o id
            
            namesList.innerHTML = '';
            for (let id in Data[i].data){
                const listItem = document.createElement('li');
                listItem.innerHTML = `<p> ${Data[i].data[id].user} </p>`;
                listItem.onclick = function() {
                    toggleDropdown(listItem, id, i);
                };
                namesList.appendChild(listItem);
            };
        }

        // Função para alternar a exibição do dropdown para cada nome
        function toggleDropdown(listItem, id, i) {
            let dropdown = listItem.querySelector('.dropdown-content');
            if (!dropdown) {
                dropdown = document.createElement('div');
                dropdown.classList.add('dropdown-content');

                //Gera o comando do drop com infos associadas
                dropdown.innerHTML = `<p> ${Data[i].data[id].time} ${Data[i].data[id].used} </p>`;
                listItem.appendChild(dropdown);
            }
            dropdown.classList.toggle('active'); // Alterna o estado do dropdown
        }

        // Função para fechar a aba lateral
        function closePanel() {
            sidePanel.classList.remove('open');  // Remove a classe para fechar a aba lateral
            gridContainer.classList.remove('grid-shift')
        }
    </script>
</body>
</html>
